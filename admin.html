<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AARMA Admin Panel | Orders</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<style>
body{font-family:'Poppins',sans-serif;background:#1a0a0a;color:#f3e5d5;padding:20px;}
h1{color:#ffb700;text-align:center;margin-bottom:20px;}
table{width:100%;border-collapse:collapse;margin-bottom:30px;}
th,td{border:1px solid #ffb700;padding:10px;text-align:left;}
th{background:#330000;color:#ffb700;}
tr:nth-child(even){background:rgba(255,183,0,0.1);}
button{padding:5px 10px;border:none;border-radius:5px;cursor:pointer;font-weight:bold;}
.status-btn{background:#ffb700;color:black;margin-right:5px;}
.delete-btn{background:#dc3545;color:white;}
a.map-link{color:#28a745;text-decoration:none;}
a.map-link:hover{text-decoration:underline;}
</style>
</head>
<body>

<h1>AARMA Restaurant | Admin Panel</h1>
<table>
<thead>
<tr>
<th>Order ID</th>
<th>Name</th>
<th>Phone</th>
<th>Address</th>
<th>Cart</th>
<th>Total (₹)</th>
<th>Status</th>
<th>Location</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="ordersTable">
<tr><td colspan="9" style="text-align:center;">Loading orders...</td></tr>
</tbody>
</table>

<script>
// Firebase Config (replace with your project keys)
const firebaseConfig = {
  apiKey: "YOUR_FIREBASE_APIKEY",
  authDomain: "YOUR_FIREBASE_AUTHDOMAIN",
  databaseURL: "YOUR_FIREBASE_DBURL",
  projectId: "YOUR_FIREBASE_PROJECTID",
  storageBucket: "YOUR_FIREBASE_BUCKET",
  messagingSenderId: "YOUR_FIREBASE_SENDERID",
  appId: "YOUR_FIREBASE_APPID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Fetch Orders
function loadOrders(){
  const table=document.getElementById('ordersTable');
  db.ref('orders').on('value',snapshot=>{
    table.innerHTML='';
    if(!snapshot.exists()){ table.innerHTML='<tr><td colspan="9" style="text-align:center;">No orders yet</td></tr>'; return; }
    const data=snapshot.val();
    Object.keys(data).forEach(key=>{
      const o=data[key];
      const cartDetails=o.cart.map(c=>`${c.name} x ${c.qty}`).join('<br>');
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${o.id}</td>
        <td>${o.name}</td>
        <td>${o.phone}</td>
        <td>${o.address}</td>
        <td>${cartDetails}</td>
        <td>${o.total}</td>
        <td>${o.status}</td>
        <td><a class="map-link" target="_blank" href="https://www.google.com/maps?q=${o.lat},${o.lng}">View</a></td>
        <td>
          <button class="status-btn" onclick="updateStatus('${o.id}')">Next Status</button>
          <button class="delete-btn" onclick="deleteOrder('${o.id}')">Delete</button>
        </td>`;
      table.appendChild(tr);
    });
  });
}

// Status update: Pending → Preparing → Delivered → Cancelled → Pending
function updateStatus(orderId){
  const ref=db.ref('orders/'+orderId);
  ref.once('value',snapshot=>{
    if(!snapshot.exists()) return;
    const curr=snapshot.val().status;
    let next='Pending';
    if(curr==='Pending') next='Preparing';
    else if(curr==='Preparing') next='Delivered';
    else if(curr==='Delivered') next='Cancelled';
    else if(curr==='Cancelled') next='Pending';
    ref.update({status:next});
  });
}

// Delete order
function deleteOrder(orderId){ if(confirm('Are you sure you want to delete this order?')) db.ref('orders/'+orderId).remove(); }

loadOrders();
</script>
</body>
</html>
